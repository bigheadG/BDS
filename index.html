<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MQTT Client on GitHub Pages</title>
	<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
	<h1>MQTT Client on GitHub Pages</h1>
	<div>
		<button id="connect">Connect to Broker</button>
		<button id="subscribe">Subscribe</button>
		<button id="publish">Publish</button>
		<input id="messageInput" placeholder="Enter message">
	</div>
	<div>
		<h2>Messages</h2>
		<pre id="messages"></pre>
	</div>

	<script>
		// MQTT broker details
		//const brokerUrl = "wss://test.mosquitto.org:8081"; // Public MQTT broker with WebSocket support
		const brokerUrl = "wss://59.124.7.967:1883"; // Public MQTT broker with WebSocket support
		const topic = "fds";
		let client;

		// Connect to MQTT broker
		document.getElementById("connect").onclick = () => {
			client = mqtt.connect(brokerUrl);

			client.on("connect", () => {
				console.log("Connected to broker!");
				document.getElementById("messages").textContent += "Connected to broker!\n";
			});

			client.on("message", (topic, message) => {
				const msg = `Received on ${topic}: ${message.toString()}\n`;
				document.getElementById("messages").textContent += msg;
			});
		};

		// Subscribe to a topic
		document.getElementById("subscribe").onclick = () => {
			if (!client) return alert("Not connected to broker!");
			client.subscribe(topic, (err) => {
				if (!err) {
					console.log(`Subscribed to ${topic}`);
					document.getElementById("messages").textContent += `Subscribed to ${topic}\n`;
				}
			});
		};

		// Publish a message
		document.getElementById("publish").onclick = () => {
			if (!client) return alert("Not connected to broker!");
			const message = document.getElementById("messageInput").value || "Hello, MQTT!";
			client.publish(topic, message);
			console.log(`Published: ${message}`);
			document.getElementById("messages").textContent += `Published: ${message}\n`;
		};
	</script>
</body>
</html>
